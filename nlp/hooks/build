#!/bin/sh

BASE=hczhu/pytorch:pytorch1.7.0cu110-cuda11.0-cudnn8-py3.7-ubuntu18.04-runtime
TRANSFORMERS=3.5.1
DATASETS=1.1.3
LIGHTNING=1.0.8
HYDRA=1.0.4
FAISS=1.6.4

TAG=hczhu/nlp:transformers${TRANSFORMERS}-datasets${DATASETS}-pl${LIGHTNING}-hydra${HYDRA}-faiss${FAISS}

DOCKER_BUILDKIT=1 docker build \
    -t $TAG \
    --build-arg BASE=${BASE}
    --build-arg TRANSFORMERS=${TRANSFORMERS} \
    --build-arg DATASETS=${DATASETS} \
    --build-arg LIGHTNING=${LIGHTNING} \
    --build-arg HYDRA=${HYDRA} \
    --build-arg FAISS=${FAISS} .

docker push ${TAG}
docker tag ${TAG} hczhu/nlp:latest
